<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Inscrição</title>

    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link rel="stylesheet" href="../css/form.css">
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">
</head>
<body>
    <main>
        <section class="container">
            <header>
                <h1>Cursos de extensão</h1>
                <p>Local: Cesvale - Riverside</p>
                <p>Data: 26 de outubro - 09, 23 e 30 de novembro de 2024</p>
            </header>
            <form class="form" name="submit-to-google-sheet" id="inscricao-form" action="#" method="post" autocomplete="on">
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">person</span>
                        <label class="subtitle" for="nome">Nome Completo</label>
                    </div>
                    <input type="text" name="nome" id="nome" placeholder="Insira o Nome Completo" autocomplete="name" required maxlength="70">
                </div>
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">email</span>
                        <label class="subtitle" for="email">Email</label>
                    </div>
                    <input type="email" name="email" id="email" placeholder="Email" autocomplete="email" required maxlength="30">
                </div>
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">phone</span>
                        <label class="subtitle" for="telefone">Telefone</label>
                    </div>
                    <input type="tel" name="telefone" id="telefone" placeholder="Telefone: (xx) xxxxx-xxxx" autocomplete="tel" required maxlength="15">
                </div>
        
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">list</span>
                        <label class="subtitle" for="categoria">Categoria</label>
                    </div>
                    <div class="column">
                        <div class="select-box">
                            <select name="categoria" id="categoria" class="select" required>
                                <option value="" hidden>Selecione a categoria</option>
                                <option value="estudante">Estudante</option>
                                <option value="demais">Demais</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">book</span>
                        <label class="subtitle" for="categoria">Curso</label>
                    </div>
                    <div class="column">
                        <div class="select-box">
                            <select name="curso" id="curso" class="select" required>
                                <option value="" hidden>Selecione o curso</option>
                                <option value="marketing">Marketing & Vendas</option>
                                <option value="negocios">Negócios & Empreendedorismo</option>
                            </select>
                        </div>
                    </div>
                </div>
        
                <div class="btns">
                    <button class="submitBTN" type="submit">Enviar</button>
                    <button class="backBTN" id="back-button" title="Voltar" onclick="window.history.back()">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                </div>
            </form>
        </section>
    </main>


    <script>
        
        document.addEventListener('DOMContentLoaded', function () {
            const telefoneInput = document.getElementById('telefone');

            telefoneInput.addEventListener('input', function (e) {
                let valor = e.target.value.replace(/\D/g, '');
                let formato = '';

                if (valor.length > 6) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}-${valor.substring(7, 11)}`;
                } else if (valor.length > 2) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}`;
                } else {
                    formato = `(${valor.substring(0, 2)}`;
                }

                e.target.value = formato;
            });

            telefoneInput.addEventListener('blur', function (e) {
                let valor = e.target.value.replace(/\D/g, '');
                let formato = '';

                if (valor.length >= 10) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}-${valor.substring(7, 11)}`;
                } else if (valor.length >= 6) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}`;
                } else {
                    formato = `(${valor.substring(0, 2)}`;
                }

                e.target.value = formato;
            });

            const form = document.getElementById('inscricao-form');
            form.addEventListener('submit', function (e) {
                const telefone = document.getElementById('telefone').value;
                const telefoneValido = /^\(\d{2}\) \d{5}-\d{4}$/.test(telefone);

                if (!telefoneValido) {
                    e.preventDefault();
                    alert('Por favor, insira um número de telefone válido no formato (xx) xxxxx-xxxx.');
                } else {
                    const categoria = document.getElementById('categoria').value;
                    let url = '';
                    const hoje = new Date();
                    hoje.setHours(0, 0, 0, 0);

                    const lote1Fim = new Date('2024-10-06');
                    lote1Fim.setHours(23, 59, 59, 999);

                    const lote2Fim = new Date('2024-10-25');
                    lote2Fim.setHours(23, 59, 59, 999);

                    if (categoria === 'estudante') {
                        if (hoje <= lote1Fim) {
                            url = 'https://mpago.la/1tTbVUK'; // 1 lote estudante
                        } else if (hoje <= lote2Fim) {
                            url = 'https://mpago.la/2NdG5FZ'; // 2 lote estudante
                        }
                    } else {
                        if (hoje <= lote1Fim) {
                            url = 'https://mpago.la/1nHLrTG'; // 1 lote demais
                        } else if (hoje <= lote2Fim) {
                            url = 'https://mpago.la/2piU3iR'; // 2 lote demais
                        }
                    }

                    exibirMensagemESucesso(url);
                }
            });
        });

        function exibirMensagemESucesso(link) {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
            <div id="sucesso">
                <h1 style="color: #fff">Inscrição realizada com sucesso!</h1>
                <p style="color: #fff">Redirecionando para o pagamento...</p>
            </div>`;

            setTimeout(function () {
                window.open(link, '_blank');
            }, 5000);
        }

        const scriptURL = 'https://script.google.com/macros/s/AKfycbwgrkoME4-nY929GodZc5M4mNLKtbCPTTadTvGwXhIIqJ7ducuSM6N5WpP-KI4PUoSn-g/exec';
        const form = document.forms['submit-to-google-sheet']; // formulario no index

        form.addEventListener('submit', e =>
        {
            e.preventDefault();

            var formData = new FormData(form);
            var data = {};

            for (var [key, value] of formData.entries())
            {
                data[key] = value;
            }
            data_result = JSON.stringify(data);

            fetch(scriptURL, { method: 'POST', body: data_result})
            .then(response =>
            {
                //alert("Feito! formulario adicionado a planilha.");
            })
            .catch(error =>
            {
                //alert("Ops. Não conseguimos receber o formulário, tente novamente ou verifique o problema");
                console.error(error);
            })
        });
    </script>
</body>
</html>